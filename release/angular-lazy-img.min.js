angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(e,n,t){"use strict";function o(){for(var e=0,n=f.length;n>e;e++){var o=f[e];o&&t.isElementInView(o.$elem[0],d.offset,g)&&(u(o),a(o),e--)}}function r(e){(d.container||m)[e]("scroll",p),(d.container||m)[e]("touchmove",p),m[e]("resize",p),m[e]("resize",y)}function s(){h=!0,setTimeout(function(){o(),r("on")},1)}function i(){h=!1,r("off")}function a(e){var n=f.indexOf(e);-1!=n&&f.splice(n,1)}function u(e){var n=new Image;d.errorClass&&e.$elem.removeClass(d.errorClass),d.successClass&&e.$elem.removeClass(d.successClass),n.onerror=function(){c(e.$elem,null),d.errorClass&&e.$elem.addClass(d.errorClass),d.onError(e)},n.onload=function(){c(e.$elem,e.src),d.successClass&&e.$elem.addClass(d.successClass),d.onSuccess(e)},n.src=e.src}function c(e,n){"img"===e[0].nodeName.toLowerCase()?n?e[0].src=n:e.removeAttr("src"):e.css("background-image",'url("'+n+'")')}function l(e){this.$elem=e}var g,m,f,h,d,p,y;return f=[],h=!1,d=n.getOptions(),m=angular.element(e),g=t.getWinDimensions(),y=t.throttle(function(){g=t.getWinDimensions()},60),p=t.throttle(o,30),l.prototype.setSource=function(e){this.src=e,f.push(this),h||s()},l.prototype.removeImage=function(){a(this),0===f.length&&i()},l}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function n(){return{height:e.innerHeight,width:e.innerWidth}}function t(e,n,t){var o=e.getBoundingClientRect(),r=t.height+n;return o.left>=-o.width&&o.right<=t.width+n&&(o.top>=-o.height&&o.top<=r||o.bottom<=r&&o.bottom>=0-n)}function o(e,n,t){var o,r;return function(){var s=t||this,i=+new Date,a=arguments;o&&o+n>i?(clearTimeout(r),r=setTimeout(function(){o=i,e.apply(s,a)},n)):(o=i,e.apply(s,a))}}return{isElementInView:t,getWinDimensions:n,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(e){"use strict";function n(n,t,o){var r=new e(t);o.$observe("lazyImg",function(e){e&&r.setSource(e)}),n.$on("$destroy",function(){r.removeImage()})}return{link:n,restrict:"A"}}]);