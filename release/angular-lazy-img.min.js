angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers","$rootScope",function(e,t,n,i){"use strict";function s(){m.scrollY=e.scrollY,m.scrollX=e.scrollX;for(var t=0,i=f.length;i>t;t++){var s=f[t];s&&n.isImageInView(s,p.offset,m)&&(l(s),a(s),t--)}}function c(e){(p.container||g)[e]("scroll",y),(p.container||g)[e]("touchmove",y),g[e]("resize",y),g[e]("resize",w)}function o(){d=!0,setTimeout(function(){s(),c("on")},1)}function r(){d=!1,c("off")}function a(e){var t=f.indexOf(e);-1!=t&&f.splice(t,1)}function l(e){var t=new Image;t.onerror=function(){u(e.$elem,null),p.errorClass&&e.$elem.addClass(p.errorClass),p.onError(e),i.$broadcast("angularLazyImgLoadError",e)},t.onload=function(){u(e.$elem,e.src),p.successClass&&e.$elem.addClass(p.successClass),p.onSuccess(e)},t.src=e.src}function u(e,t){"img"===e[0].nodeName.toLowerCase()?t?e[0].src=t:e.removeAttr("src"):e.css("background-image",'url("'+t+'")')}function h(e){this.$elem=e,this.clearCachedRect()}var m,g,f,d,p,y,w;return f=[],d=!1,p=t.getOptions(),g=angular.element(e),m=n.getWinDimensions(),w=n.throttle(function(){m=n.getWinDimensions()},80),y=n.throttle(s,50),h.prototype.clearCachedRect=function(){this.cachedRect={clientRect:null,winDimensions:null}},h.prototype.setSource=function(e){this.src=e,this.clearCachedRect(),p.errorClass&&this.$elem.removeClass(p.errorClass),p.successClass&&this.$elem.removeClass(p.successClass),u(this.$elem,null),f.push(this),d?setTimeout(y,0):o()},h.prototype.removeImage=function(){a(this),this.clearCachedRect(),0===f.length&&r()},h.prototype.cachedRectNeedsUpdate=function(e){return!this.cachedRect.clientRect||!this.cachedRect.winDimensions||this.cachedRect.winDimensions.scrollX!=e.scrollX||this.cachedRect.winDimensions.scrollY!=e.scrollY||this.cachedRect.winDimensions.width!=e.width||this.cachedRect.winDimensions.height!=e.height},h}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function t(){return{height:e.innerHeight,width:e.innerWidth}}function n(e,t,n){var i=e.cachedRect.clientRect;if(e.cachedRectNeedsUpdate(n)){var s=e.$elem[0];i=s.getBoundingClientRect(),e.cachedRect.clientRect=JSON.parse(JSON.stringify(i)),e.cachedRect.winDimensions=JSON.parse(JSON.stringify(n))}var c=n.height+t;return i.left>=-i.width&&i.right<=n.width+t&&(i.top>=-i.height&&i.top<=c||i.bottom<=c&&i.bottom>=0-t)}function i(e,t,n){var i,s;return function(){var c=n||this,o=+new Date,r=arguments;i&&i+t>o?(clearTimeout(s),s=setTimeout(function(){i=o,e.apply(c,r)},t)):(i=o,e.apply(c,r))}}return{isImageInView:n,getWinDimensions:t,throttle:i}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(e){"use strict";function t(t,n,i){var s=new e(n);i.$observe("lazyImg",function(e){e&&s.setSource(e)}),t.$on("$destroy",function(){s.removeImage()})}return{link:t,restrict:"A"}}]);