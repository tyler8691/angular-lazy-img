angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(e,t,n){"use strict";function i(){h.scrollY=e.scrollY,h.scrollX=e.scrollX;for(var t=0,i=g.length;i>t;t++){var s=g[t];s&&n.isImageInView(s,d.offset,h)&&(a(s),r(s),t--)}}function s(e){(d.container||m)[e]("scroll",p),(d.container||m)[e]("touchmove",p),m[e]("resize",p),m[e]("resize",y)}function c(){f=!0,setTimeout(function(){i(),s("on")},1)}function o(){f=!1,s("off")}function r(e){var t=g.indexOf(e);-1!=t&&g.splice(t,1)}function a(e){var t=new Image;t.onerror=function(){l(e.$elem,null),d.errorClass&&e.$elem.addClass(d.errorClass),d.onError(e)},t.onload=function(){l(e.$elem,e.src),d.successClass&&e.$elem.addClass(d.successClass),d.onSuccess(e)},t.src=e.src}function l(e,t){"img"===e[0].nodeName.toLowerCase()?t?e[0].src=t:e.removeAttr("src"):e.css("background-image",'url("'+t+'")')}function u(e){this.$elem=e,this.clearCachedRect()}var h,m,g,f,d,p,y;return g=[],f=!1,d=t.getOptions(),m=angular.element(e),h=n.getWinDimensions(),y=n.throttle(function(){h=n.getWinDimensions()},80),p=n.throttle(i,50),u.prototype.clearCachedRect=function(){this.cachedRect={clientRect:null,winDimensions:null}},u.prototype.setSource=function(e){this.src=e,this.clearCachedRect(),d.errorClass&&this.$elem.removeClass(d.errorClass),d.successClass&&this.$elem.removeClass(d.successClass),l(this.$elem,null),g.push(this),f?setTimeout(p,0):c()},u.prototype.removeImage=function(){r(this),this.clearCachedRect(),0===g.length&&o()},u.prototype.cachedRectNeedsUpdate=function(e){return!this.cachedRect.clientRect||!this.cachedRect.winDimensions||this.cachedRect.winDimensions.scrollX!=e.scrollX||this.cachedRect.winDimensions.scrollY!=e.scrollY||this.cachedRect.winDimensions.width!=e.width||this.cachedRect.winDimensions.height!=e.height},u}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function t(){return{height:e.innerHeight,width:e.innerWidth}}function n(e,t,n){var i=e.cachedRect.clientRect;if(e.cachedRectNeedsUpdate(n)){var s=e.$elem[0];i=s.getBoundingClientRect(),e.cachedRect.clientRect=JSON.parse(JSON.stringify(i)),e.cachedRect.winDimensions=JSON.parse(JSON.stringify(n))}var c=n.height+t;return i.left>=-i.width&&i.right<=n.width+t&&(i.top>=-i.height&&i.top<=c||i.bottom<=c&&i.bottom>=0-t)}function i(e,t,n){var i,s;return function(){var c=n||this,o=+new Date,r=arguments;i&&i+t>o?(clearTimeout(s),s=setTimeout(function(){i=o,e.apply(c,r)},t)):(i=o,e.apply(c,r))}}return{isImageInView:n,getWinDimensions:t,throttle:i}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(e){"use strict";function t(t,n,i){var s=new e(n);i.$observe("lazyImg",function(e){e&&s.setSource(e)}),t.$on("$destroy",function(){s.removeImage()})}return{link:t,restrict:"A"}}]);