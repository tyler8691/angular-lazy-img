angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(e,n,t){"use strict";function i(){m.scrollY=e.scrollY,m.scrollX=e.scrollX;for(var n=0,i=h.length;i>n;n++){var s=h[n];s&&t.isImageInView(s,d.offset,m)&&(a(s),r(s),n--)}}function s(e){(d.container||g)[e]("scroll",p),(d.container||g)[e]("touchmove",p),g[e]("resize",p),g[e]("resize",w)}function o(){f=!0,setTimeout(function(){i(),s("on")},1)}function c(){f=!1,s("off")}function r(e){var n=h.indexOf(e);-1!=n&&h.splice(n,1)}function a(e){var n=new Image;d.errorClass&&e.$elem.removeClass(d.errorClass),d.successClass&&e.$elem.removeClass(d.successClass),n.onerror=function(){l(e.$elem,null),d.errorClass&&e.$elem.addClass(d.errorClass),d.onError(e)},n.onload=function(){l(e.$elem,e.src),d.successClass&&e.$elem.addClass(d.successClass),d.onSuccess(e)},n.src=e.src}function l(e,n){"img"===e[0].nodeName.toLowerCase()?n?e[0].src=n:e.removeAttr("src"):e.css("background-image",'url("'+n+'")')}function u(e){this.$elem=e,this.cachedRect={clientRect:null,winDimensions:null}}var m,g,h,f,d,p,w;return h=[],f=!1,d=n.getOptions(),g=angular.element(e),m=t.getWinDimensions(),w=t.throttle(function(){m=t.getWinDimensions()},60),p=t.throttle(i,30),u.prototype.setSource=function(e){this.src=e,h.push(this),f||o()},u.prototype.removeImage=function(){r(this),0===h.length&&c()},u.prototype.cachedRectNeedsUpdate=function(e){return!this.cachedRect.clientRect||!this.cachedRect.winDimensions||this.cachedRect.winDimensions.scrollX!=e.scrollX||this.cachedRect.winDimensions.scrollY!=e.scrollY||this.cachedRect.winDimensions.width!=e.width||this.cachedRect.winDimensions.height!=e.height},u}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function n(){return{height:e.innerHeight,width:e.innerWidth}}function t(e,n,t){var i=e.cachedRect.clientRect;if(e.cachedRectNeedsUpdate(t)){var s=e.$elem[0];i=s.getBoundingClientRect(),e.cachedRect.clientRect=i,e.cachedRect.winDimensions=t}var o=t.height+n;return i.left>=-i.width&&i.right<=t.width+n&&(i.top>=-i.height&&i.top<=o||i.bottom<=o&&i.bottom>=0-n)}function i(e,n,t){var i,s;return function(){var o=t||this,c=+new Date,r=arguments;i&&i+n>c?(clearTimeout(s),s=setTimeout(function(){i=c,e.apply(o,r)},n)):(i=c,e.apply(o,r))}}return{isImageInView:t,getWinDimensions:n,throttle:i}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(e){"use strict";function n(n,t,i){var s=new e(t);i.$observe("lazyImg",function(e){e&&s.setSource(e)}),n.$on("$destroy",function(){s.removeImage()})}return{link:n,restrict:"A"}}]);