angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(e,n,t){"use strict";function r(){g.scrollY=e.scrollY,g.scrollX=e.scrollX;for(var n=0,r=f.length;r>n;n++){var o=f[n];o&&t.isImageInView(o,d.offset,g)&&(i(o),l(o),n--)}}function o(e){(d.container||m)[e]("scroll",p),(d.container||m)[e]("touchmove",p),m[e]("resize",p),m[e]("resize",v)}function s(){h=!0,setTimeout(function(){r(),o("on")},1)}function c(){h=!1,o("off")}function l(e){var n=f.indexOf(e);-1!=n&&f.splice(n,1)}function i(e){var n=new Image;d.errorClass&&e.$elem.removeClass(d.errorClass),d.successClass&&e.$elem.removeClass(d.successClass),n.onerror=function(){a(e.$elem,null),d.errorClass&&e.$elem.addClass(d.errorClass),d.onError(e)},n.onload=function(){a(e.$elem,e.src),d.successClass&&e.$elem.addClass(d.successClass),d.onSuccess(e)},n.src=e.src}function a(e,n){"img"===e[0].nodeName.toLowerCase()?n?e[0].src=n:e.removeAttr("src"):e.css("background-image",'url("'+n+'")')}function u(e){this.$elem=e,this.cachedRect={clientRect:null,scrollY:null,scrollX:null}}var g,m,f,h,d,p,v;return f=[],h=!1,d=n.getOptions(),m=angular.element(e),g=t.getWinDimensions(),v=t.throttle(function(){g=t.getWinDimensions()},60),p=t.throttle(r,30),u.prototype.setSource=function(e){this.src=e,f.push(this),h||s()},u.prototype.removeImage=function(){l(this),0===f.length&&c()},u}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var e=this.options;return{getOptions:function(){return e}}},this.setOptions=function(e){angular.extend(this.options,e)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(e){"use strict";function n(){return{height:e.innerHeight,width:e.innerWidth}}function t(e,n,t){var r=e.cachedRect.clientRect;if(!r||e.cachedRect.scrollY!=t.scrollY||e.cachedRect.scrollX!=t.scrollX){var o=e.$elem[0];r=o.getBoundingClientRect(),e.cachedRect.clientRect=r,e.cachedRect.scrollY=scrollY,e.cachedRect.scrollX=scrollX}var s=t.height+n;return r.left>=-r.width&&r.right<=t.width+n&&(r.top>=-r.height&&r.top<=s||r.bottom<=s&&r.bottom>=0-n)}function r(e,n,t){var r,o;return function(){var s=t||this,c=+new Date,l=arguments;r&&r+n>c?(clearTimeout(o),o=setTimeout(function(){r=c,e.apply(s,l)},n)):(r=c,e.apply(s,l))}}return{isImageInView:t,getWinDimensions:n,throttle:r}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(e){"use strict";function n(n,t,r){var o=new e(t);r.$observe("lazyImg",function(e){e&&o.setSource(e)}),n.$on("$destroy",function(){o.removeImage()})}return{link:n,restrict:"A"}}]);