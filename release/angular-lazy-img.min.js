angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","lazyImgConfig","lazyImgHelpers",function(a,b,c){"use strict";function k(){for(var a=0,b=f.length;b>a;a++){var e=f[a];e&&c.isElementInView(e.$elem[0],h.offset,d)&&(p(e),o(e),a--)}}function l(a){(h.container||e)[a]("scroll",i),(h.container||e)[a]("touchmove",i),e[a]("resize",i),e[a]("resize",j)}function m(){g=!0,setTimeout(function(){k(),l("on")},1)}function n(){g=!1,l("off")}function o(a){var b=f.indexOf(a);-1!=b&&f.splice(b,1)}function p(a){var b=new Image;b.onerror=function(){h.errorClass&&a.$elem.addClass(h.errorClass),h.onError(a)},b.onload=function(){q(a.$elem,a.src),h.successClass&&a.$elem.addClass(h.successClass),h.onSuccess(a)},b.src=a.src}function q(a,b){"img"===a[0].nodeName.toLowerCase()?a[0].src=b:a.css("background-image",'url("'+b+'")')}function r(a){this.$elem=a}var d,e,f,g,h,i,j;return f=[],g=!1,h=b.getOptions(),e=angular.element(a),d=c.getWinDimensions(),j=c.throttle(function(){d=c.getWinDimensions()},60),i=c.throttle(k,30),r.prototype.setSource=function(a){this.src=a,f.push(this),g||m()},r.prototype.removeImage=function(){o(this),0===f.length&&n()},r}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var a=this.options;return{getOptions:function(){return a}}},this.setOptions=function(a){angular.extend(this.options,a)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(a){"use strict";function b(){return{height:a.innerHeight,width:a.innerWidth}}function c(a,b,c){var d=a.getBoundingClientRect(),e=c.height+b;return d.left>=0&&d.right<=c.width+b&&(d.top>=0&&d.top<=e||d.bottom<=e&&d.bottom>=0-b)}function d(a,b,c){var d,e;return function(){var f=c||this,g=+new Date,h=arguments;d&&d+b>g?(clearTimeout(e),e=setTimeout(function(){d=g,a.apply(f,h)},b)):(d=g,a.apply(f,h))}}return{isElementInView:c,getWinDimensions:b,throttle:d}}]),angular.module("angularLazyImg").directive("lazyImg",["LazyImgMagic",function(a){"use strict";function b(b,c,d){var e=new a(c);d.$observe("lazyImg",function(a){a&&e.setSource(a)}),b.$on("$destroy",function(){e.removeImage()})}return{link:b,restrict:"A"}}]);